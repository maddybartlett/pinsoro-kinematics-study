
<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="jspsych-6.0.2/jspsych.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-fullscreen.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-video.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-survey-likert.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.0.2/plugins/jspsych-image-keyboard-response.js"></script>
        <link href="jspsych-6.0.2/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
        <script>

      // generate a random subject ID
    var participant = Math.floor(Math.random()*10000);
    var survey_code = Math.floor(Math.random()*10000000);
    var pstring = participant.toString();
    var sstring = survey_code.toString();
    var subject_id = pstring + sstring;

    jsPsych.data.addProperties({
      subject: participant,
      surveyCode: survey_code,
    });

//Open full screen window
    var timeline = [];
    timeline.push({
        type: 'fullscreen',
        fullscreen_mode: true
    });

//Welcome page
    var welcome = {
        type: "html-keyboard-response",
        stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);

//MTurk ID
  var mturkID = {
      type: 'survey-text',
      questions: [{prompt: "Please enter your MTurk Worker ID: ",
                  rows: 1, columns: 70}],
  };
     timeline.push(mturkID);

     jsPsych.data.addProperties({
       mturkID: mturkID,
     });

     // declare the block.
     var consent_trial = {
       type: 'html-button-response',
       stimulus: '<p> Consent Form. <p>' + '<p> In this experiment you will watch videos of children interacting.<p>' + '<p> You will be asked questions about each video that you watch. <p>' + '<p> Your responses will be anonymised and saved at the end of the experiment.<p>' + '<p> You can withdraw from the experiment any time without penalty or loss of benefits to which you are otherwise entitled. You can withdraw by pressing the ESC button during the experiment, or by contacting the researchers after completing the experiment. <p>' + '<p> If you have any questions please contact Severin Lemaignan at severin.lemaignan@uwe.ac.uk <p>' + '<p> <p>' + '<p> Please indicate below if you consent to participate in this study. (If you choose not to consent, press ESC to leave the experiment window.) <p>',
       choices: ['I consent','I do not consent'],
       on_finish: function(data){
         if(data.button_pressed == 1){
           jsPsych.endExperiment();
         if(data.button_pressed == 0){
           jsPsych.data.addProperties({
             consent: "consent given"
           });
       }
     }
   }
 }
     timeline.push(consent_trial);

//Instructions page
  var instructionsskel = {
      type: "html-keyboard-response",
      stimulus: "<p>During this experiment you will be shown 4 short videos of skeletal figures representing children interacting.</p>" +
      "<p> Pay particular attention to the way the children interact. </p>"+
      "<p> After each video you will be asked some questions about what you have watched. <p/>" +
      "<p>Press any key to begin.</p>",
      post_trial_gap: 1500
    };

    var instructionsorig = {
        type: "html-keyboard-response",
        stimulus: "<p>During this experiment you will be shown 4 short videos of children interacting.</p>" +
        "<p> Pay particular attention to the way the children interact. </p>"+
        "<p> After each video you will be asked some questions about what you have watched. <p/>" +
        "<p>Press any key to begin.</p>",
        post_trial_gap: 1500
    };

    //Demographics
      var demographics1 = {
          type: 'survey-text',
          questions: [{prompt: "How old are you?"}, {prompt: "What is your nationality?"}, {prompt: "What is your first language?"}, {prompt: "What is your highest educational qualification?"}],
      };

         jsPsych.data.addProperties({
           Demographics: demographics1,
         });

      var scale_gender = ["Male", "Female", "Prefer not to say"];

     //Demographics
       var demographics2 = {
           type: 'survey-likert',
           questions: [{prompt:"What is your gender?", labels: scale_gender}]
       };

          jsPsych.data.addProperties({
            Demographics: demographics2,
          });

//stimulus lists for trials in skeleton video condition
    var skel_trials = [
        { stimulus: "clips/2017-05-18-152118060656-independentdistress.mp4" },
        { stimulus: "clips/2017-06-01-102743523980-jointtask.mp4" },
        { stimulus: "clips/2017-06-06-145135235899-independent.mp4" },
        { stimulus: "clips/2017-06-06-150808383862-fight.mp4" },
        { stimulus: "clips/2017-06-13-110008089945-fight.mp4" },
        { stimulus: "clips/2017-06-13-140354392253-laugh.mp4" },
        { stimulus: "clips/2017-06-16-110134843091-turntaking.mp4" },
        { stimulus: "clips/2017-06-20-105505400084-showing.mp4" },
        { stimulus: "clips/2017-06-20-140956193720-showingfight.mp4" },
        { stimulus: "clips/2017-06-22-101045562870-playing.mp4" },
        { stimulus: "clips/2017-06-22-111246014789-jointtask.mp4" },
        { stimulus: "clips/2017-06-23-104918496756-independent.mp4" },
        { stimulus: "clips/2017-06-26-112331105839-1task1watch.mp4" },
        { stimulus: "clips/2017-06-27-105946305604-laughing.mp4" },
        { stimulus: "clips/2017-06-27-143652394670-turntaking.mp4" },
        { stimulus: "clips/2017-06-29-105524492596-1task1watch.mp4" },
        { stimulus: "clips/2017-07-05-102437565816-gestures.mp4" },
        { stimulus: "clips/2017-07-06-093740908665-demonstratemanhandle.mp4" },
        { stimulus: "clips/2017-07-06-101405806926-adjusting.mp4" },
        { stimulus: "clips/2017-07-06-110834943320-thinking.mp4" }
    ];
//selection of four random videos from above list to use in trials
    var skel_videos = jsPsych.randomization.sampleWithoutReplacement(skel_trials, 4);

//stimulus lists for trials in original video condition
    var orig_trials = [
        { stimulus: "clips/raw-2017-05-18-152118060656-independentdistress.mp4" },
        { stimulus: "clips/raw-2017-06-01-102743523980-jointtask.mp4" },
        { stimulus: "clips/raw-2017-06-06-145135235899-independent.mp4" },
        { stimulus: "clips/raw-2017-06-06-150808383862-fight.mp4" },
        { stimulus: "clips/raw-2017-06-13-110008089945-fight.mp4" },
        { stimulus: "clips/raw-2017-06-13-140354392253-laugh.mp4" },
        { stimulus: "clips/raw-2017-06-16-110134843091-turntaking.mp4" },
        { stimulus: "clips/raw-2017-06-20-105505400084-showing.mp4" },
        { stimulus: "clips/raw-2017-06-20-140956193720-showingfight.mp4" },
        { stimulus: "clips/raw-2017-06-22-101045562870-playing.mp4" },
        { stimulus: "clips/raw-2017-06-22-111246014789-jointtask.mp4" },
        { stimulus: "clips/raw-2017-06-23-104918496756-independent.mp4" },
        { stimulus: "clips/raw-2017-06-26-112331105839-1task1watch.mp4" },
        { stimulus: "clips/raw-2017-06-27-105946305604-laughing.mp4" },
        { stimulus: "clips/raw-2017-06-27-143652394670-turntaking.mp4" },
        { stimulus: "clips/raw-2017-06-29-105524492596-1task1watch.mp4" },
        { stimulus: "clips/raw-2017-07-05-102437565816-gestures.mp4" },
        { stimulus: "clips/raw-2017-07-06-093740908665-demonstratemanhandle.mp4" },
        { stimulus: "clips/raw-2017-07-06-101405806926-adjusting.mp4" },
        { stimulus: "clips/raw-2017-07-06-110834943320-thinking.mp4" }
    ];
//selection of four random videos from above list to use in trials
    var orig_videos = jsPsych.randomization.sampleWithoutReplacement(orig_trials, 4);

//video display
    var video_stimulus = {
        type: "video",
        width: 700,
        height: 500,
        prompt: "<p>(This video has no sound)</p>",
        sources: [jsPsych.timelineVariable('stimulus')],
    };

//open-ended questions
    var free_text1 = {
        type: 'survey-text',
        questions: [{prompt: "What did you notice about the children and their interaction?",
                     rows: 10, columns: 70}],
    };
    var free_text2 = {
        type: 'survey-text',
        questions: [{prompt: "How old do you think these characters are?",
                     rows: 5, columns: 40}],
    };

//scales for specific questions
    var scale_yes_no = ["Yes", "Not sure", "No"];
    var scale_relationship = ["Friends", "Neutral", "Not Friends"];
    var options_1 = ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"];
    var options_2 = ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"];

//specific questions
    var likert_page3 = {
      type: 'survey-likert',
      questions: [{prompt:"Are these characters getting along well?", labels: scale_yes_no}]
    };
    var likert_page4 = {
      type: 'survey-likert',
      questions: [{prompt:"What is the relationship between these characters?", labels: scale_relationship}]
    };
    var likert_page5 = {
      type: 'survey-likert',
      questions: [{prompt:"Are these characters working together?", labels: scale_yes_no}]
    };
    var multi_page6 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was dominant", labels: options_1}, {prompt:"The character on my right was dominant", labels: options_2}]
    };
    var multi_page7 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was cooperative", labels: options_1}, {prompt:"The character on my right was cooperative", labels: options_2}]
    };
    var multi_page8 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was competitive", labels: options_1}, {prompt:"The character on my right was competitive", labels: options_2}]
    };
    var multi_page9 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was friendly", labels: options_1}, {prompt:"The character on my right was friendly", labels: options_2}]
    };
    var multi_page10 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was aggressive", labels: options_1}, {prompt:"The character on my right was aggressive", labels: options_2}]
    };
    var multi_page11 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was engaged with the task", labels: options_1}, {prompt:"The character on my right was engaged with the task", labels: options_2}]
    };
    var multi_page12 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was feeling fearful", labels: options_1}, {prompt:"The character on my right was feeling fearful", labels: options_2}]
    };
    var multi_page13 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was feeling sad", labels: options_1}, {prompt:"The character on my right was feeling sad", labels: options_2}]
    };
    var multi_page14 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was feeling content", labels: options_1}, {prompt:"The character on my right was feeling content", labels: options_2}]
    };
    var multi_page15 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was feeling angry", labels: options_1}, {prompt:"The character on my right was feeling angry", labels: options_2}]
    };
    var multi_page16 = {
      type: 'survey-likert',
      questions: [{prompt:"The character on my left was feeling amused", labels: options_1}, {prompt:"The character on my right was feeling amused", labels: options_2}]
    };

//conditions
    var condition1 = {
        timeline: [video_stimulus, free_text1],
        timeline_variables: skel_videos,
        randomize_order: true
    };

    var condition2 = {
        timeline: [video_stimulus, free_text1, free_text2, likert_page3, likert_page4, likert_page5, multi_page6, multi_page7, multi_page8, multi_page9, multi_page10, multi_page11, multi_page12, multi_page13, multi_page14, multi_page15, multi_page16],
        timeline_variables: skel_videos,
        randomize_order: true
    };
    var condition3 = {
        timeline: [video_stimulus, free_text1],
        timeline_variables: orig_videos,
        randomize_order: true
    };

    var condition4 = {
        timeline: [video_stimulus, free_text1, free_text2, likert_page3, likert_page4, likert_page5, multi_page6, multi_page7, multi_page8, multi_page9, multi_page10, multi_page11, multi_page12, multi_page13, multi_page14, multi_page15, multi_page16],
        timeline_variables: orig_videos,
        randomize_order: true
    };

    var debriefskel = {
      type: "html-keyboard-response",
      stimulus: "<p>Debrief.<br /> This study examines what types of information humans can gain from observing people's movements in a social interaction. <br /> We showed you skeleton versions of videos of social interactions showing stick-men figures. <br /> Other participants will have watched the original videos of real people. <br /> We want to know what people can work out about the interaction from watching the stick figures (movement only) compared to the original videos. <br /> If you have any questions please contact Severin Lemaignan at severin.lemaignan@uwe.ac.uk <br /> Press any key to continue. </p>"
    };

    var debrieforig = {
      type: "html-keyboard-response",
      stimulus: "<p>Debrief.<br /> This study examines what types of information humans can gain from observing people's movements in a social interaction. <br /> We showed you the original versions of videos of social interactions showing real people. <br /> Other participants will have watched skeleton versions showing stick-figures. <br /> We want to know what people can work out about the interaction from watching the stick figures (movement only) compared to the original videos. <br /> If you have any questions please contact Severin Lemaignan at severin.lemaignan@uwe.ac.uk <br /> Press any key to continue. </p>"
    };

    var thankyou = {
    type: "html-keyboard-response",
    choices: [13],
    stimulus: "This is your Survey Completion Code. Please note this down and submit it to MTurk: " + survey_code + "<p>You have reached the end of the experiment.<br /> Thank you very much for participating!<br /> Press ESC to leave the experiment window.</p>"
  };

//condition assignment according to randomly generated participant number
    var timelineAssigned = [];

    if(participant%4 == 0){
      timelineAssigned = timeline.concat(demographics1, demographics2, instructionsskel, condition1, debriefskel, thankyou);
    } else if (participant%4 == 1){
      timelineAssigned = timeline.concat(demographics1, demographics2, instructionsskel, condition2, debriekskel, thankyou);
    } else if (participant%4 == 2){
      timelineAssigned = timeline.concat(demographics1, demographics2, instructionsorig, condition3, debrieforig, thankyou);
    } else if (participant%4 == 3){
      timelineAssigned = timeline.concat(demographics1, demographics2, instructionsorig, condition4, debrieforig, thankyou);
    };

//display condition number in data file
    jsPsych.data.addProperties({
      condition: (participant%4)+1,
    });

    function saveData(filename, filedata){
       $.ajax({
          type:'post',
          cache: false,
          url: 'write_data.php',
          data: {filename: filename, filedata: filedata}
       });
    }

    /* start the experiment */

    jsPsych.init({
      timeline: timelineAssigned,
      on_trial_finish: function(){
        saveData(subject_id+"_data.csv", jsPsych.data.get().csv());
      }
    });

    </script>
</html>
